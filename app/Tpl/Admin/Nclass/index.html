<include file="Public:header" />
	 <title>小说分类管理</title>
     <include file="Public:header_css" />
	 <include file="Public:footer_js" />
	</head>
	<body>
		<div class="container">
	    <include file="Public:top_nav" />
			<div class="row">
			   <include file="Public:left_menu" />
				<div class="span10">
					<h3>
						小说分类列表
						<small>
						  <a class="toggle-link" href="#new-file"><i class="icon-plus"></i>添加新的分类</a>
				       	<form id="new-file" class="form-horizontal hidden" action="{:U('/Admin/Nclass/add')}" method="POST">
						  <fieldset>
							  <div class="control-group">
								<label class="control-label" for="name">分类名</label>
								 <div class="controls">
									<input type="text" class="input-xlarge" id="name" name="name"/>
								 </div>
							  </div>
							  <div class="control-group">
								<label class="control-label" for="ncdesc">简介</label>
								<div class="controls">
								   <textarea class="input-xlarge" id="ncdesc" name="ncdesc" rows="5"></textarea>
								</div>
							  </div>
							   <div class="control-group">
								<label class="control-label" for="logo">封面图片</label>
								<div class="controls">
									<input class="input-xlarge" id="logo" name="logo" type="text" />&nbsp;&nbsp;
									<span id="swfupload" class="btn"></span>
									{:W('Upload',array('BTN_W'=>60,'target'=>'logo','error'=>'swferror','preview'=>'imgclass'))}
									<br/>
									<img src="{$ADMIN_PATH}nopic.gif" width="120px" height="60px" id="imgclass">
									<br/>
									<p id="swferror" class="alert alert-danger span3 hide"></p>
								</div>
							  </div>
							   <div class="control-group">
								<label class="control-label" for="url">访问地址</label>
								<div class="controls">
									<input class="input-xlarge" id="url" name="url" type="text" />
								</div>
							  </div>
							 <div class="form-actions">
							 	<button type="submit" class="btn btn-primary">添加分类</button>
							  </div>
						    </fieldset>
					    </form>
						</small>
					</h3>
					<table class="table table-bordered table-striped">
						<thead>
							<tr>
								<th>分类名称</th>
								<th> 简介</th>
								<th>访问地址</th>
								<th> 封面图片 </th>
								<th> 小说数量 </th>
								<th> 操作 </th>
							</tr>
						</thead>
						<tbody>
						   <volist name="clist" id="vo">
							<tr id="tr{$vo.ncid}">
							    <td <if condition="$vo['state'] eq 0">style="background-color:red;"<else/>style="background-color:green;"</if>>{$vo.name}</td>
								<td>{$vo.ncdesc}</td>
								<td>{$vo.url}</td>
								<td>
								  <img src="<if condition="$vo['logo']">/{$vo.logo}<else/>{$ADMIN_PATH}nopic.gif</if>"  width="80"  height="30">
								</td>
								<td>{$vo.cn}</td>
								<td > 
								   <a href="{:U('/Admin/Nclass/edit','id='.$vo['ncid'])}"   rel="{$vo.said}"   title="编辑分类">
								     <i class="icon-edit"></i>
								   </a> 
								   <a href="javascript:void(0);" class="u_ban" rel="{$vo.ncid}" data="{$vo.state}" 
								   title="<if condition="$vo['state'] eq 1">隐藏该目录<else/>显示该目录</if>">
								   <i class="<if condition="$vo['state'] eq 1">icon-minus-sign<else/>icon-ok-sign</if>"></i>
								   </a> 
								 </td>
							</tr>
					       </volist>  
						</tbody>
					</table>
					 <div class="pagination">
						 {$pagestr}共有 {$call} 条数据，当前第 {$pnow} 页
					</div>
				</div>
			   </div>
		 </div>

<script type="text/javascript">
 $(function(){
	$('.u_ban').click(
	 function(){
	  var rel = $(this).attr('rel');
	  var state = $(this).attr('data');
	  $.ajax({
	      type: "POST",
          url: "{:U('/Admin/Nclass/ban')}" ,
		  data:{ncid:rel,state:state},
          dataType: "json",
		  success:function(r)
		  {
			  if( undefined != r.rcode  && parseInt(r.rcode)>0)
			  {
                 location.reload();
			  }
			  else
			  {
			    alert( r.msg );
				return;
			  }
		  },
		  error:function(r){
		   alert("Ajax 请求错误");
		  }
	  });
	 }
	);
 });
</script>
<include file="Public:footer" />